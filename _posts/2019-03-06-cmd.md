---
categories: linux-cmd
---

# pkill killall
```
平时都是kill pid, 有时候挺麻烦的, 虽然也知道killall, pkill命令的存在, 但是总有不确定的感觉, 比如killall a, 会不会把aa kill掉, /usr/bin/a能不能一起kill掉

下面是总结

killall是忽略启动路径, 只匹配可执行文件名, 所以a和/usr/bin/a会一起kill掉
killall可执行文件名需要全等, killall a不会kill aa, 需要正则的时候就使用-r, 默认信号是SIGTERM

pkill的功能就强大很多, 可以根据各种不同的条件来kill
-g Only match processes in the process group IDs listed
-f 带上参数一起
-n 所有进程的最新
-o 最旧
-P 父进程是多少
-s session id来匹配
-t terminal来匹配
其他看man


```

# pgrep 用来找指定命令的进程

**pgrep不匹配全名, pkill匹配全名**

pgrep perf 默认只显示pid, -l显示命令 -a显示命令行全信息

还有一些其他的条件, groupid, tty, parent, 看man

```
-g Only match processes in the process group IDs listed
-f 带上参数一起
-n 所有进程的最新
-o 最旧
-P 父进程是多少
-s session id来匹配
-t terminal来匹配
其他看man
```


# vm starttime

```
date -d "`cut -f1 -d. /proc/uptime` seconds ago"
ps -eo pid,lstart,cmd |grep container
```


# 开机时间

```last -x |grep run```可以历史系统运行的时间段

```last -10```显示的是用户登录历史



# dir compare 需要比较文件夹里面的文件是不是一样
```
其实就是把所有文件排序以后, cat到一起计算, 有时候上下文件叠换, 会有问题, 勉强可以使用
find tmp/ |sort  -u |xargs cat |md5sum
```


# strace
strace 只是strace主线程, 需要子线程的话, 需要strace -f

# time时间
## date 显示指定时间戳时间

```
date -d @1551773019
Tue Mar  5 16:03:39 CST 2019
```

## ntp 同步时间
```
ntpdate  ntp1.aliyun.com
```

## 时区
```
rm -f /etc/localtime
ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
```

# tty
## console tty 区别
tty teletypewriter, linux里面有输入, 输出的设备, 现在基本都是虚拟设备, pts之类的

console, 特殊的tty, 可以显示系统日志的, 比如刚开机

## 获取当前tty
```
tty
/dev/pts/15
```
## 检查是否是一个tty
```
tty -s
echo $?
```

## dump tty info
```
$stty -a
speed 38400 baud; rows 65; columns 231; line = 0;
```


# gzip gunzip

```
gzip [file-name]

强制gzip不能删除原文件
gzip -k [file-name]

gzip列表详细信息与压缩文件相关
gzip -l [compressed-file-name]

没有文件名, stdin读取, stdout输出
cat filename |gzip > filename

```

# gunzip
和gzip功能相反, 其他都一样


# tty auto login
 
/usr/lib/systemd/system/serial-getty@.service
 
add -a root

# qemu launch cmd

```qemu-system-x86_64-lite -nographic  -serial mon:stdio -smp 4 -m 8000 -drive file=xcentos.qcow2,if=virtio   -kernel vmlinux -append "root=/dev/vda1 console=ttyS0" -gdb tcp::5 -redir tcp:15::22```

```qemu-system-x86_64 -enable-kvm -nographic -serial mon:stdio -smp 4 -m 8000 -drive file=xcentos.qcow2,if=virtio   -kernel arch/x86/boot/bzImage -append "root=/dev/vda1 console=ttyS0"```



# 换系统目录启动 chroot

```
mkdir /mnt/abc
mount /dev/sda3 /mnt/abc
mkdir /mnt/abc/dev
mkdir /mnt/abc/proc
mkdir /mnt/abc/sys
mount --bind /dev /mnt/abc/dev
mount --bind /proc /mnt/abc/proc
mount --bind /sys /mnt/abc/sys
chroot /mnt/abc
grub-install /dev/sda

```


# ssh connect
## 修改服务器端参数

在其中添加一行内容,意思是向客户端每60秒发一次保持连接的信号

ClientAliveInterval  60

如果仍要设置断开时间,还有一个参数可以添加

ClientAliveCountMax  60

意思是如果客户端60次未响应就断开连接,依据你期望的时间来设定

## 修改本地参数

也可以让客户端向服务器发送保持连接信号,路径是/etc/ssh/ssh_config

在其中类似的添加相应的参数也行

ServerAliveInterval  5

ServerAliveCountMax  3

